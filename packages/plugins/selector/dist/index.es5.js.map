{"version":3,"file":"index.es5.js","sources":["../../../core/dist/GondelPluginUtils.js","Selector.js","cache.js","injector.js","decorator.js"],"sourcesContent":["var basePluginListener = function (result, data, next) { return next(result); };\n// Global plugin events registry\nvar pluginEventRegistry = window.__gondelPluginEvents || { pluginMapping: {}, pluginEvents: {} };\nwindow.__gondelPluginEvents = pluginEventRegistry;\n/** Global Plugin Event Handler Registry */\nexport var pluginEvents = pluginEventRegistry.pluginEvents;\n// Mapping to track if plugin was already registered to prevent double registrations\nvar pluginMapping = pluginEventRegistry.pluginMapping;\nexport function fireGondelPluginEvent(eventName, initialValue, data, callback) {\n    var isSyncron = false;\n    var callbackResult;\n    // Execute all bound events for the given name\n    // if they exist\n    (pluginEvents[eventName] || basePluginListener)(initialValue, data, function (processedResult) {\n        isSyncron = true;\n        callbackResult = callback ? callback(processedResult) : processedResult;\n    });\n    // Add a guard to prevent asyncron plugin listeners\n    // to simplify the usage of fireGondelPluginEvent\n    if (!isSyncron) {\n        throw new Error(\"Async plugin listener\");\n    }\n    return callbackResult;\n}\n/**\n * Fire an async event which allows gondel plugins to add features to gondel\n */\nexport function fireAsyncGondelPluginEvent(eventName, initialValue, data) {\n    return new Promise(function (resolve) {\n        (pluginEvents[eventName] || basePluginListener)(initialValue, data, function (result) {\n            resolve(result);\n        });\n    });\n}\n/**\n * Allow plugins to hook into the gondel event system\n */\nexport function addGondelPluginEventListener(pluginName, eventName, eventListenerCallback) {\n    // Prevent any event registration if this pluginHandlerName\n    // has already been used\n    var pluginHandlerNamePerEvent = eventName + \"#\" + pluginName;\n    if (pluginMapping[pluginHandlerNamePerEvent]) {\n        return;\n    }\n    // Flag plugin as registered\n    pluginMapping[pluginHandlerNamePerEvent] = true;\n    // Ensure that an entry for the given event name exists\n    if (!pluginEvents[eventName]) {\n        pluginEvents[eventName] = basePluginListener;\n    }\n    var previousEventHandler = pluginEvents[eventName];\n    pluginEvents[eventName] = function wrapCallback(result, data, next) {\n        previousEventHandler(result, data, function callNextPlugin(modifiedResult, _, firstNext) {\n            eventListenerCallback(modifiedResult, data, function bindData(result) {\n                next(result, data, firstNext);\n            });\n        });\n    };\n}\n//# sourceMappingURL=GondelPluginUtils.js.map","var Selector = /** @class */ (function () {\n    function Selector(gondelComponent, binding) {\n        this.gondelComponent = gondelComponent;\n        var propertyKey = binding[0], selector = binding[1], options = binding[2];\n        this.boundPropertyKey = propertyKey;\n        this.selector = selector;\n        this.options = options;\n    }\n    Object.defineProperty(Selector.prototype, \"all\", {\n        /**\n         * Returns a list of matching DOM components found in the current component context\n         * @returns {T[]} List of DOM elements\n         */\n        get: function () {\n            var nodes = this.gondelComponent._ctx.querySelectorAll(this.selector);\n            if (!nodes) {\n                throw new Error(\"No components found in \" + this.gondelComponent._componentName + \" for \" + this.selector);\n            }\n            return Array.prototype.slice.call(nodes);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Selector.prototype, \"first\", {\n        /**\n         * Returns the first matching element of matching DOM nodes in the current component context\n         * @returns {T} The DOM element\n         */\n        get: function () {\n            if (this.all.length === 0) {\n                throw new Error(\"No first component for \" + this.selector + \" found in \" + this.gondelComponent._componentName);\n            }\n            return this.all[0];\n        },\n        enumerable: true,\n        configurable: true\n    });\n    /**\n     * Executes a lookup for different context with the current selector options\n     * @param {C} context\n     */\n    Selector.prototype.getInContext = function (context) {\n        var nodes = context.querySelectorAll(this.selector);\n        if (!nodes) {\n            throw new Error(\"No components found in context \" + context + \" for \" + this.selector);\n        }\n        return Array.prototype.slice.call(nodes);\n    };\n    /**\n     * Returns a readable string for debugging\n     * @example\n     * 'Selector(Component.property) .a-heading > h2'\n     */\n    Selector.prototype.toString = function () {\n        return \"Selector(\" + this.gondelComponent._componentName + \".\" + this.boundPropertyKey + \") \" + this.selector;\n    };\n    return Selector;\n}());\nexport { Selector };\n//# sourceMappingURL=Selector.js.map","/**\n * TODO: describe\n */\nexport var lookupCache = new WeakMap();\n//# sourceMappingURL=cache.js.map","import { addGondelPluginEventListener } from \"@gondel/core\";\nimport { Selector } from \"./Selector\";\nimport { lookupCache } from \"./cache\";\nexport var areSelectorsHookedIntoCore = false;\nexport function injectSelectorPluginIntoCore() {\n    areSelectorsHookedIntoCore = true;\n    addGondelPluginEventListener(\"Selector\", \"start\", function (gondelComponents, _, next) {\n        gondelComponents.forEach(function (gondelComponent) {\n            var componentBoundSelectors = (gondelComponent.prototype &&\n                gondelComponent.prototype.__boundSelectors) ||\n                gondelComponent.__boundSelectors;\n            if (!componentBoundSelectors || componentBoundSelectors.length === 0) {\n                return next(gondelComponents);\n            }\n            componentBoundSelectors.forEach(function (_a) {\n                var propertyKey = _a[0], selector = _a[1], options = _a[2];\n                // create new selector cache for current gondel component\n                if (!lookupCache.has(gondelComponent)) {\n                    lookupCache.set(gondelComponent, new Map());\n                }\n                // get corresponding cache for the current component\n                var selectorCache = lookupCache.get(gondelComponent);\n                Object.defineProperty(gondelComponent, propertyKey, {\n                    enumerable: true,\n                    configurable: false,\n                    get: function () {\n                        if (options.cache && selectorCache.has(selector)) {\n                            // found in cache, return cached one\n                            return selectorCache.get(selector);\n                        }\n                        var selectorInst = new Selector(gondelComponent, [propertyKey, selector, options]);\n                        selectorCache.set(selector, selectorInst);\n                        return selectorInst;\n                    },\n                    set: function (_value) {\n                        throw new Error(\"You're not allowed to set \" + propertyKey + \" manually\");\n                    }\n                });\n            });\n        });\n        next(gondelComponents);\n    });\n}\n//# sourceMappingURL=injector.js.map","import { areSelectorsHookedIntoCore, injectSelectorPluginIntoCore } from \"./injector\";\n/**\n * The @selector decorator will lookup the nodes on access including caching (enabled by default)\n */\nexport function selector(domSelector, options) {\n    if (options === void 0) { options = { cache: true }; }\n    return function (target, propertyKey) {\n        if (!areSelectorsHookedIntoCore) {\n            // prevent multiple hook listeners\n            injectSelectorPluginIntoCore();\n        }\n        if (!target.__boundSelectors) {\n            target.__boundSelectors = [];\n        }\n        target.__boundSelectors.push([propertyKey, domSelector, options]);\n    };\n}\n//# sourceMappingURL=decorator.js.map"],"names":["basePluginListener","result","data","next","pluginEventRegistry","window","__gondelPluginEvents","pluginMapping","pluginEvents","Selector","Object","defineProperty","prototype","get","nodes","this","gondelComponent","_ctx","querySelectorAll","selector","Error","_componentName","Array","slice","call","enumerable","configurable","all","length","getInContext","context","toString","boundPropertyKey","binding","propertyKey","options","lookupCache","WeakMap","areSelectorsHookedIntoCore","injectSelectorPluginIntoCore","pluginName","eventName","eventListenerCallback","pluginHandlerNamePerEvent","previousEventHandler","modifiedResult","_","firstNext","addGondelPluginEventListener","gondelComponents","forEach","componentBoundSelectors","__boundSelectors","_a","has","set","Map","selectorCache","cache","selectorInst","_value","domSelector","target","push"],"mappings":"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"}