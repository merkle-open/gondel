{"version":3,"file":"index.es5.js","sources":["../../../core/dist/GondelPluginUtils.js","Selector.js","cache.js","injector.js","decorator.js"],"sourcesContent":["var basePluginListener = function (result, data, next) { return next(result); };\n// Global plugin events registry\nvar pluginEventRegistry = window.__gondelPluginEvents || { pluginMapping: {}, pluginEvents: {} };\nwindow.__gondelPluginEvents = pluginEventRegistry;\n/** Global Plugin Event Handler Registry */\nexport var pluginEvents = pluginEventRegistry.pluginEvents;\n// Mapping to track if plugin was already registered to prevent double registrations\nvar pluginMapping = pluginEventRegistry.pluginMapping;\nexport function fireGondelPluginEvent(eventName, initialValue, data, callback) {\n    var isSyncron = false;\n    var callbackResult;\n    // Execute all bound events for the given name\n    // if they exist\n    (pluginEvents[eventName] || basePluginListener)(initialValue, data, function (processedResult) {\n        isSyncron = true;\n        callbackResult = callback ? callback(processedResult) : processedResult;\n    });\n    // Add a guard to prevent asyncron plugin listeners\n    // to simplify the usage of fireGondelPluginEvent\n    if (!isSyncron) {\n        throw new Error(\"Async plugin listener\");\n    }\n    return callbackResult;\n}\n/**\n * Fire an async event which allows gondel plugins to add features to gondel\n */\nexport function fireAsyncGondelPluginEvent(eventName, initialValue, data) {\n    return new Promise(function (resolve) {\n        (pluginEvents[eventName] || basePluginListener)(initialValue, data, function (result) {\n            resolve(result);\n        });\n    });\n}\n/**\n * Allow plugins to hook into the gondel event system\n */\nexport function addGondelPluginEventListener(pluginName, eventName, eventListenerCallback) {\n    // Prevent any event registration if this pluginHandlerName\n    // has already been used\n    var pluginHandlerNamePerEvent = eventName + \"#\" + pluginName;\n    if (pluginMapping[pluginHandlerNamePerEvent]) {\n        return;\n    }\n    // Flag plugin as registered\n    pluginMapping[pluginHandlerNamePerEvent] = true;\n    // Ensure that an entry for the given event name exists\n    if (!pluginEvents[eventName]) {\n        pluginEvents[eventName] = basePluginListener;\n    }\n    var previousEventHandler = pluginEvents[eventName];\n    pluginEvents[eventName] = function wrapCallback(result, data, next) {\n        previousEventHandler(result, data, function callNextPlugin(modifiedResult, _, firstNext) {\n            eventListenerCallback(modifiedResult, data, function bindData(result) {\n                next(result, data, firstNext);\n            });\n        });\n    };\n}\n//# sourceMappingURL=GondelPluginUtils.js.map","var Selector = /** @class */ (function () {\n    function Selector(gondelComponent, binding) {\n        this.gondelComponent = gondelComponent;\n        var propertyKey = binding[0], selector = binding[1], options = binding[2];\n        this.boundPropertyKey = propertyKey;\n        this.selector = selector;\n        this.options = options;\n    }\n    Object.defineProperty(Selector.prototype, \"all\", {\n        get: function () {\n            var nodes = this.gondelComponent._ctx.querySelectorAll(this.selector);\n            if (!nodes) {\n                throw new Error(\"No components found in \" + this.gondelComponent._componentName + \" for \" + this.selector);\n            }\n            return Array.prototype.slice.call(nodes);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Selector.prototype, \"first\", {\n        get: function () {\n            return this.all[0];\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Selector.prototype.getInContext = function (context) {\n        var nodes = context.querySelectorAll(this.selector);\n        if (!nodes) {\n            throw new Error(\"No components found in \" + this.gondelComponent._componentName + \" for \" + this.selector);\n        }\n        return Array.prototype.slice.call(nodes);\n    };\n    Selector.prototype.toString = function () {\n        return \"Selector(\" + this.gondelComponent._componentName + \".\" + this.boundPropertyKey + \") \" + this.selector;\n    };\n    return Selector;\n}());\nexport { Selector };\n//# sourceMappingURL=Selector.js.map","/**\n * TODO: describe\n */\nexport var lookupCache = new WeakMap();\n//# sourceMappingURL=cache.js.map","import { addGondelPluginEventListener } from \"@gondel/core\";\nimport { Selector } from \"./Selector\";\nimport { lookupCache } from \"./cache\";\nexport var areSelectorsHookedIntoCore = false;\nexport function injectSelectorPluginIntoCore() {\n    areSelectorsHookedIntoCore = true;\n    addGondelPluginEventListener(\"Selector\", \"start\", function (gondelComponents, _, next) {\n        gondelComponents.forEach(function (gondelComponent) {\n            var componentBoundSelectors = (gondelComponent.prototype &&\n                gondelComponent.prototype.__boundSelectors) ||\n                gondelComponent.__boundSelectors;\n            if (!componentBoundSelectors || componentBoundSelectors.length === 0) {\n                return next(gondelComponents);\n            }\n            componentBoundSelectors.forEach(function (_a) {\n                var propertyKey = _a[0], selector = _a[1], options = _a[2];\n                // create new selector cache for current gondel component\n                if (!lookupCache.has(gondelComponent)) {\n                    lookupCache.set(gondelComponent, new Map());\n                }\n                // get corresponding cache for the current component\n                var selectorCache = lookupCache.get(gondelComponent);\n                Object.defineProperty(gondelComponent, propertyKey, {\n                    enumerable: true,\n                    configurable: false,\n                    get: function () {\n                        if (options.cache && selectorCache.has(selector)) {\n                            // found in cache, return cached one\n                            return selectorCache.get(selector);\n                        }\n                        var selectorInst = new Selector(gondelComponent, [propertyKey, selector, options]);\n                        selectorCache.set(selector, selectorInst);\n                        return selectorInst;\n                    },\n                    set: function (_value) {\n                        throw new Error(\"You're not allowed to set \" + propertyKey + \" manually\");\n                    }\n                });\n            });\n        });\n        next(gondelComponents);\n    });\n}\n//# sourceMappingURL=injector.js.map","import { areSelectorsHookedIntoCore, injectSelectorPluginIntoCore } from './injector';\n/**\n * The @selector decorator will lookup the nodes on access including caching (enabled by default)\n */\nexport function selector(domSelector, options) {\n    if (options === void 0) { options = { cache: true }; }\n    return function (target, propertyKey) {\n        if (!areSelectorsHookedIntoCore) {\n            // prevent multiple hook listeners\n            injectSelectorPluginIntoCore();\n        }\n        if (!target.__boundSelectors) {\n            target.__boundSelectors = [];\n        }\n        target.__boundSelectors.push([propertyKey, domSelector, options]);\n    };\n}\n//# sourceMappingURL=decorator.js.map"],"names":["basePluginListener","result","data","next","pluginEventRegistry","window","__gondelPluginEvents","pluginMapping","pluginEvents","Selector","Object","defineProperty","prototype","get","nodes","this","gondelComponent","_ctx","querySelectorAll","selector","Error","_componentName","Array","slice","call","enumerable","configurable","all","getInContext","context","toString","boundPropertyKey","binding","propertyKey","options","lookupCache","WeakMap","areSelectorsHookedIntoCore","injectSelectorPluginIntoCore","pluginName","eventName","eventListenerCallback","pluginHandlerNamePerEvent","previousEventHandler","modifiedResult","_","firstNext","addGondelPluginEventListener","gondelComponents","forEach","componentBoundSelectors","__boundSelectors","length","_a","has","set","Map","selectorCache","cache","selectorInst","_value","domSelector","target","push"],"mappings":"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"}