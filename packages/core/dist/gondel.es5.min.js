!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((n="undefined"!=typeof globalThis?globalThis:n||self).gondel={})}(this,(function(n){"use strict";var e=function(n,e,t){return t(n)},t=window.__gondelPluginEvents||{pluginMapping:{},pluginEvents:{}};window.__gondelPluginEvents=t;var o=t.pluginEvents,r=t.pluginMapping;function c(n,t,r,c){var i,a=!1;if((o[n]||e)(t,r,(function(n){a=!0,i=c?c(n):n})),!a)throw new Error("Async plugin listener");return i}function i(n,t,c){var i="".concat(t,"#").concat(n);if(!r[i]){r[i]=!0,o[t]||(o[t]=e);var a=o[t];o[t]=function(n,e,t){a(n,e,(function(n,o,r){c(n,e,(function(n){t(n,e,r)}))}))}}}function a(n,e,t,o,r){void 0===o&&(o={}),void 0===r&&(r=!0);var c=document.createEvent("Event"),i=t?y(t):e._ctx,a=e._namespace;if(n.substr(0,a.length)!==a)throw new Error("Invalid event name '"+n+"' - use '"+a+n.charAt(0).toUpperCase()+n.slice(1)+"'");return c.initEvent(n,r,!0),c.data={component:e,name:e._componentName,namespace:e._namespace,eventData:o},i.dispatchEvent(c)}var u=function(){},s=function(){var n=this;this.promise=new Promise((function(e){n.resolve=e}))};function f(n,e,t){var o=Array.prototype.slice.call(e.querySelectorAll("[data-".concat(t,"-name]")));e.hasAttribute("data-".concat(t,"-name"))&&o.push(e);var r=o.filter((function(n){return function(n,e){return!n.hasOwnProperty(_+e)}(n,t)})),i=new s;r.forEach((function(n){!function(n,e,t){n[_+t]=e}(n,i.promise,t)}));var a,f,m=c("boot",r,{namespace:t},(function(e){return e.map((function(e){return function(n,e,t){var o=n.getAttribute("data-".concat(t,"-name")),r=e.getComponent(o);if(void 0===r)throw new Error("Failed to boot component - ".concat(o," is not registred"));var c=new r(n,o);return c._ctx=n,c._namespace=t,c._componentName=o,c.stop=d.bind(null,c,c.stop||u,t),n["_gondel_"+t]=c,c}(e,n,t)}))})),l=(a=n,f={},m.forEach((function(n){return f[n._componentName]=!0})),Object.keys(f).filter((function(n){return!a._activeComponents[n]})));l.forEach((function(e){return n.setActiveState(e,!0)}));var v=c("start",m,{newComponentNames:l,namespace:t,gondelComponentRegistry:n},(function(n){return Promise.all(n.map(p))})).then((function(){return m.forEach((function(n){n.sync&&n.sync()})),c("sync",m,{namespace:t})}));return v.then(i.resolve,i.resolve).then((function(){return v})),v}function p(n){if(n.start)return 0===n.start.length?n.start():new Promise((function(e,t){return n.start(e,t)}))}function d(n,e,t){a("".concat(t,"Stop"),n,n._ctx),delete n._ctx[h+t],delete n._ctx[_+t],n._stopped=!0,c("stop",n,{namespace:t},e.bind(n))}var m,l=function(){function n(){this._components={},this._activeComponents={},this._bootMode=2}return n.prototype.registerComponent=function(n,e){this._components[n]=e},n.prototype.unregisterComponent=function(n){delete this._components[n]},n.prototype.getComponent=function(n){return this._components[n]},n.prototype.setActiveState=function(n,e){this._activeComponents[n]=e},n.prototype.setBootMode=function(n){this._bootMode=n},n}();function v(n){return m||(m=window["__ðŸš¡Registries"]||{},window["__ðŸš¡Registries"]=m),m[n]||(m[n]=new l,function(n){var e=function(){Promise.resolve().then((function(){var e=v(n);2===e._bootMode&&(e.setBootMode(0),f(e,document.documentElement,n))}))};"complete"==document.readyState?e():document.addEventListener("DOMContentLoaded",e,!1)}(n)),m[n]}function g(){var n=arguments,e=n[0],t="string"==typeof n[1]?n[1]:"g",o=n[n.length-1],r=v(t);r.getComponent(e)&&c("unregister",o,{componentName:e,namespace:t}),c("register",o,{componentName:e,namespace:t,gondelComponentRegistry:r},(function(n){r.registerComponent(e,n)}))}var h="_gondel_",_="_gondelA_";function y(n){return function(n){return void 0!==n.nodeType}(n)?n:n[0]}function E(n,e){void 0===e&&(e="g");var t=y(n)[h+e];return!(!t||!t._ctx)}function w(n,e){void 0===e&&(e="g");var t=b(y(n),e);if(!t)throw new Error('Could not find a started gondel component in namespace "'.concat(e,"\",\nplease check if your component is mounted via 'hasMountedGondelComponent'"));return t}function b(n,e){var t=n[h+e];if(t&&t._ctx)return t}function C(n,e,t){void 0===n&&(n=document.documentElement),void 0===t&&(t="g");for(var o=y(n),r=[],c="_gondel_".concat(t),i=o.querySelectorAll("[data-".concat(t,"-name").concat(e?'="'.concat(e,'"'):"","]")),a=0;a<i.length;a++){var u=i[a],s=u[c];s&&s._ctx===u&&r.push(s)}return r}var x,M={focus:"focusin",blur:"focusout"},N=function(n,e){var t=window.Element.prototype,o=t.matches||t.matchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.webkitMatchesSelector;return(N=function(n,e){return o.call(n,e)})(n,e)};function P(n,e,t,o){var r=function(n,e,t){var o=function(n){for(var e=[],t=n;t;t=t.parentElement)e.push(t);return e}(t),r=[];o.forEach((function(t,o){var c=t.getAttribute(n),i=c&&e[c];i&&r.push({index:o,handlers:i})}));var c=[];return r.forEach((function(n){var e=n.index,t=n.handlers;Object.keys(t).forEach((function(n){if(!n)return c.push({index:e,ctx:o[e],target:o[e],handlerOptions:t[n]});for(var r=e;--r>=0;)if(N(o[r],n))return c.push({index:r,ctx:o[e],target:o[r],handlerOptions:t[n]})}))})),0===c.length?[]:(c.sort((function(n,e){return n.index>e.index?1:n.index===e.index?0:-1})),c)}(e,t,o.target);!function(n,e,t){for(var o=!1,r=[],c=function(c){var i=n[c],a=i.handlerOptions,u=b(i.ctx,t);if(u){Object.defineProperty(e,"currentTarget",{get:function(){return i.target},configurable:!0}),o=!0;for(var s=0;s<a.length&&!e.cancelBubble;s++){var f=u[a[s].handlerName].call(u,e);"function"==typeof f&&r.push(f)}}},i=0;i<n.length&&!e.cancelBubble;i++)c(i);r.forEach((function(n){n()})),o&&delete e.currentTarget}(r,o,n)}function A(n){return x||(x=window["__ðŸš¡DomEvents"]||{},window["__ðŸš¡DomEvents"]=x),x[n]||(x[n]={}),x[n]}function O(n,e,t,o,r){var i=A(n);i[e]||(i[e]={},c("registerEvent",!0,{eventName:e,namespace:n,eventRegistry:i[e]},(function(t){t&&function(n,e){document.documentElement.addEventListener(M[n]||n,P.bind(null,e,"data-".concat(e,"-name"),A(e)[n]))}(e,n)}))),i[e][t]||(i[e][t]={});var a=("object"==typeof r?r:{selector:r}).selector||"";i[e][t][a]||(i[e][t][a]=[]),i[e][t][a].push(Object.assign({handlerName:o,handlerOption:r}))}function S(){i("GondelDecorators","register",(function(n,e,t){var o=e.componentName,r=e.namespace;if(!e.gondelComponentRegistry._activeComponents[o])return t(n);var c=n.prototype&&n.prototype.__events||n.__events;c&&c.forEach((function(n){O(r,n[0],o,n[1],n[2])})),t(n)})),i("GondelDecorators","unregister",(function(n,e,t){var o=e.componentName;!function(n,e){var t=A(n);for(var o in t)t.hasOwnProperty(o)&&delete t[o][e]}(e.namespace,o),t(n)})),i("GondelDecorators","start",(function(n,e,t){var o=e.newComponentNames,r=e.gondelComponentRegistry,c=e.namespace;o.forEach((function(n){var e=r.getComponent(n),t=e.prototype&&e.prototype.__events||e.__events;t&&t.forEach((function(e){O(c,e[0],n,e[1],e[2])}))})),t(n)}))}var D=function(){function n(n,e){}return n.prototype.stop=function(){},n}();n.Component=function(n,e){return function(t){g(n,e,t)}},n.EventListener=function(n,e){return function(t,o){if(S(),"_"!==o.substr(0,1))throw new Error("Invalid handler name '".concat(o,"' use '_").concat(o,"' instead."));t.__events||(t.__events=[]),t.__events.push([n,o,e])}},n.GondelBaseComponent=D,n.addGondelPluginEventListener=i,n.disableAutoStart=function(n){void 0===n&&(n="g"),v(n).setBootMode(1)},n.findComponents=C,n.getComponentByDomNode=w,n.getComponentByDomNodeAsync=function(n,e){void 0===e&&(e="g");var t=y(n),o=t[_+e];return o?o._ctx?Promise.resolve(o):o.then((function(){return t[h+e]})):Promise.reject(void 0)},n.getFirstDomNode=y,n.hasMountedGondelComponent=E,n.registerComponent=g,n.startComponents=function(n,e){return void 0===e&&(e="g"),f(v(e),n?y(n):document.documentElement,e)},n.stopComponents=function(n,e){void 0===e&&(e="g");var t=C(n,void 0,e);n&&E(n)&&t.unshift(w(n)),t.forEach((function(n){return n.stop()}))},n.triggerPublicEvent=a,Object.defineProperty(n,"__esModule",{value:!0})}));
//# sourceMappingURL=gondel.es5.min.js.map
