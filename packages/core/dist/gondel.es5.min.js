!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(e.gondel={})}(this,function(e){"use strict";var a=function(e,n,t){return t(e)},c=window.__gondelPluginEvents||{};function f(e,n,t,o){var r,i=!1;if((c[e]||a)(n,t,function(e){i=!0,r=o?o(e):e}),!i)throw new Error("Async plugin listener");return r}function n(e,i){c[e]||(c[e]=a);var n=c[e];c[e]=function(e,o,r){n(e,o,function(e,n,t){i(e,o,function(e){r(e,o,t)})})}}window.__gondelPluginEvents=c;var r=function(){function e(){this._components={},this._activeComponents={}}return e.prototype.registerComponent=function(e,n){this._components[e]=n},e.prototype.unregisterComponent=function(e){delete this._components[e]},e.prototype.getComponent=function(e){return this._components[e]},e.prototype.setActiveState=function(e,n){this._activeComponents[e]=n},e}(),i=window.__gondelRegistries=window.__gondelRegistries||{};function o(){var e=arguments,n=e[0],t="string"==typeof e[1]?e[1]:"g",o=e[e.length-1];i[t]||(i[t]=new r),i[t].getComponent(n)&&f("unregister",o,{componentName:n,namespace:t}),f("register",o,{componentName:n,namespace:t,gondelComponentRegistry:i[t]},function(e){i[t].registerComponent(n,e)})}function m(e,n,t,o,r){void 0===o&&(o={}),void 0===r&&(r=!0);var i=document.createEvent("Event"),a=t?s(t):n._ctx;if(e[0]!==n._namespace)throw new Error("Invalid event name '"+e+"' - use '"+n._namespace+e.charAt(0).toUpperCase()+e.slice(1)+"'");return i.initEvent(e,r,!0),i.data={component:n,name:n._componentName,namespace:n._namespace,eventData:o},a.dispatchEvent(i)}var d=function(){},l=function(){var n=this;this.promise=new Promise(function(e){n.resolve=e})};function t(n,e,o){var t=Array.prototype.slice.call(e.querySelectorAll("[data-"+o+"-name]"));e.hasAttribute("data-"+o+"-name")&&t.push(e);var r=t.filter(function(e){return n=o,!e.hasOwnProperty(h+n);var n}),i=new l;r.forEach(function(e){var n,t;n=e,t=i.promise,n[h+o]=t});var a,c,u=f("boot",r,{namespace:o},function(e){return e.map(function(e){return function(e,n,t){var o=e.getAttribute("data-"+t+"-name"),r=n.getComponent(o);if(void 0===r)throw new Error("Failed to boot component - "+o+" is not registred");var i=new r(e,o);return i._ctx=e,i._namespace=t,i._componentName=o,i.stop=function(e,n,t){m(t+"Stop",e,e._ctx),delete e._ctx[g+t],delete e._ctx[h+t],e._stopped=!0,f("stop",e,{namespace:t},n.bind(e))}.bind(null,i,i.stop||d,t),e["_gondel_"+t]=i}(e,n,o)})}),s=(a=n,c={},u.forEach(function(e){return c[e._componentName]=!0}),Object.keys(c).filter(function(e){return!a._activeComponents[e]}));s.forEach(function(e){return n.setActiveState(e,!0)});var p=f("start",u,{newComponentNames:s,namespace:o,gondelComponentRegistry:n},function(e){return Promise.all(e.map(v))}).then(function(){return u.forEach(function(e){e.sync&&e.sync()}),f("sync",u,{namespace:o})});return p.then(i.resolve,i.resolve).then(function(){return p}),p}function v(t){if(t.start)return 0===t.start.length?t.start():new Promise(function(e,n){return t.start(e,n)})}var g="_gondel_",h="_gondelA_";function s(e){return void 0!==e.nodeType?e:e[0]}function _(e,n){void 0===n&&(n="g");var t=s(e),o=t[g+n];if(o&&o._ctx)return o;throw new Error("Could not find any gondel component under "+t.nodeName+' in namespace "'+n+"\", \n    please check if your component is mounted via 'hasMountedGondelComponent'")}function u(e,n,t){void 0===e&&(e=document.documentElement),void 0===t&&(t="g");for(var o=[],r="_gondel_"+t,i=s(e).querySelectorAll("[data-"+t+"-name"+(n?'="'+n+'"':"")+"]"),a=0;a<i.length;a++){var c=i[a],u=c[r];u&&u._ctx===c&&o.push(u)}return o}var p={focus:"focusin",blur:"focusout"},y=window.__gondelDomEvents||{};window.__gondelDomEvents=y;var E=Element.prototype.matches||Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector;function w(e,n,t,o){!function(e,n,t){for(var o=!1,r=[],i=0;i<e.length&&!n.cancelBubble;i++){var a=e[i],c=a.handlerOptions,u=_(a.ctx,t);if(u){Object.defineProperty(n,"currentTarget",{value:a.target,configurable:!0}),o=!0;for(var s=0;s<c.length&&!n.cancelBubble;s++){var p=u[c[s].handlerName].call(u,n);"function"==typeof p&&r.push(p)}}}r.forEach(function(e){e()}),o&&delete n.currentTarget}(function(r,i,e){var a=function(e){for(var n=[],t=e;t;t=t.parentElement)n.push(t);return n}(e),c=[];a.forEach(function(e,n){var t=e.getAttribute(r),o=t&&i[t];o&&c.push({index:n,handlers:o})});var u=[];return c.forEach(function(e){var t=e.index,o=e.handlers;Object.keys(o).forEach(function(e){if(!e)return u.push({index:t,ctx:a[t],target:a[t],handlerOptions:o[e]});for(var n=t;0<=--n;)if(E.call(a[n],e))return u.push({index:n,ctx:a[t],target:a[n],handlerOptions:o[e]})})}),0===u.length?[]:(u.sort(function(e,n){return e.index>n.index?1:e.index===n.index?0:-1}),u)}(n,t,o.target),o,e)}function C(e){return y[e]||(y[e]={}),y[e]}function b(o,r,e,n,t){var i=C(o);i[r]||(i[r]={},f("registerEvent",!0,{eventName:r,namespace:o,eventRegistry:i[r]},function(e){var n,t;e&&(n=r,t=o,document.documentElement.addEventListener(p[n]||n,w.bind(null,t,"data-"+t+"-name",y[t][n])))})),i[r][e]||(i[r][e]={});var a=("object"==typeof t?t:{selector:t}).selector||"";i[r][e][a]||(i[r][e][a]=[]),i[r][e][a].push(Object.assign({handlerName:n,handlerOption:t}))}var x=!1;function N(){x=!0,n("register",function(e,n,t){var o=n.componentName,r=n.namespace;if(!n.gondelComponentRegistry._activeComponents[o])return t(e);var i=e.prototype&&e.prototype.__events||e.__events;i&&i.forEach(function(e){b(r,e[0],o,e[1],e[2])}),t(e)}),n("unregister",function(e,n,t){var o=n.componentName;!function(e,n){var t=C(e);for(var o in t)t.hasOwnProperty(o)&&delete t[o][n]}(n.namespace,o),t(e)}),n("start",function(e,n,t){var o=n.newComponentNames,r=n.gondelComponentRegistry,i=n.namespace;o.forEach(function(n){var e=r.getComponent(n),t=e.prototype&&e.prototype.__events||e.__events;t&&t.forEach(function(e){b(i,e[0],n,e[1],e[2])})}),t(e)})}var A=function(){function e(){}return e.prototype.stop=function(){},e}();e.addGondelPluginEventListener=n,e.registerComponent=o,e.internalGondelRefAttribute=g,e.internalGondelAsyncRefAttribute=h,e.getFirstDomNode=s,e.startComponents=function(e,n){return void 0===n&&(n="g"),i[n]?t(i[n],e?s(e):document.documentElement,n):Promise.resolve([])},e.stopComponents=function(e,n){void 0===n&&(n="g");var t=u(e,void 0,n),o=e&&_(e);o&&t.unshift(o),t.forEach(function(e){return e.stop()})},e.hasMountedGondelComponent=function(e,n){void 0===n&&(n="g");var t=s(e)[g+n];return!(!t||!t._ctx)},e.getComponentByDomNode=_,e.getComponentByDomNodeAsync=function(e,n){void 0===n&&(n="g");var t=s(e),o=t[h+n];return o?o._ctx?Promise.resolve(o):o.then(function(){return t[g+n]}):Promise.reject(void 0)},e.findComponents=u,e.Component=function(n,t){return function(e){o(n,t,e)}},e.EventListener=function(t,o){return function(e,n){if(x||N(),"_"!==n.substr(0,1))throw new Error("Invalid handler name '"+n+"' use '_"+n+"' instead.");e.__events||(e.__events=[]),e.__events.push([t,n,o])}},e.triggerPublicEvent=m,e.GondelBaseComponent=A,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=gondel.es5.min.js.map
