!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((n=n||self).gondel={})}(this,function(n){"use strict";var a=function(n,e,t){return t(n)},e=window.__gondelPluginEvents||{pluginMapping:{},pluginEvents:{}},u=(window.__gondelPluginEvents=e).pluginEvents,o=e.pluginMapping;function s(n,e,t,o){var r,i=!1;if((u[n]||a)(e,t,function(n){i=!0,r=o?o(n):n}),!i)throw new Error("Async plugin listener");return r}function t(n,e,i){var t=e+"#"+n;if(!o[t]){o[t]=!0,u[e]||(u[e]=a);var c=u[e];u[e]=function(n,o,r){c(n,o,function(n,e,t){i(n,o,function(n){r(n,o,t)})})}}}function f(n,e,t,o,r){void 0===o&&(o={}),void 0===r&&(r=!0);var i=document.createEvent("Event"),c=t?E(t):e._ctx;if(n[0]!==e._namespace)throw new Error("Invalid event name '"+n+"' - use '"+e._namespace+n.charAt(0).toUpperCase()+n.slice(1)+"'");return i.initEvent(n,r,!0),i.data={component:e,name:e._componentName,namespace:e._namespace,eventData:o},c.dispatchEvent(i)}var p=function(){},d=function(){var e=this;this.promise=new Promise(function(n){e.resolve=n})};function r(e,n,t){var o=Array.prototype.slice.call(n.querySelectorAll("[data-"+t+"-name]"));n.hasAttribute("data-"+t+"-name")&&o.push(n);var r=o.filter(function(n){return function(n,e){return!n.hasOwnProperty(y+e)}(n,t)}),i=new d;r.forEach(function(n){!function(n,e,t){n[y+t]=e}(n,i.promise,t)});var c=s("boot",r,{namespace:t},function(n){return n.map(function(n){return function(n,e,t){var o=n.getAttribute("data-"+t+"-name"),r=e.getComponent(o);if(void 0===r)throw new Error("Failed to boot component - "+o+" is not registred");var i=new r(n,o);return i._ctx=n,i._namespace=t,i._componentName=o,i.stop=function(n,e,t){f(t+"Stop",n,n._ctx),delete n._ctx[_+t],delete n._ctx[y+t],n._stopped=!0,s("stop",n,{namespace:t},e.bind(n))}.bind(null,i,i.stop||p,t),n["_gondel_"+t]=i}(n,e,t)})}),a=function(n,e){var t={};return n.forEach(function(n){return t[n._componentName]=!0}),Object.keys(t).filter(function(n){return!e._activeComponents[n]})}(c,e);a.forEach(function(n){return e.setActiveState(n,!0)});var u=s("start",c,{newComponentNames:a,namespace:t,gondelComponentRegistry:e},function(n){return Promise.all(n.map(m))}).then(function(){return c.forEach(function(n){n.sync&&n.sync()}),s("sync",c,{namespace:t})});return u.then(i.resolve,i.resolve).then(function(){return u}),u}function m(t){if(t.start)return 0===t.start.length?t.start():new Promise(function(n,e){return t.start(n,e)})}var i,c="__ðŸš¡Registries",l=(v.prototype.registerComponent=function(n,e){this._components[n]=e},v.prototype.unregisterComponent=function(n){delete this._components[n]},v.prototype.getComponent=function(n){return this._components[n]},v.prototype.setActiveState=function(n,e){this._activeComponents[n]=e},v.prototype.setBootMode=function(n){this._bootMode=n},v);function v(){this._components={},this._activeComponents={},this._bootMode=2}function g(n){return i||(i=window[c]||{},window[c]=i),i[n]||(i[n]=new l,function(e){function n(){Promise.resolve().then(function(){var n=g(e);2===n._bootMode&&(n.setBootMode(0),r(n,document.documentElement,e))})}"complete"==document.readyState?n():document.addEventListener("DOMContentLoaded",n,!1)}(n)),i[n]}function h(){var n=arguments,e=n[0],t="string"==typeof n[1]?n[1]:"g",o=n[n.length-1],r=g(t);r.getComponent(e)&&s("unregister",o,{componentName:e,namespace:t}),s("register",o,{componentName:e,namespace:t,gondelComponentRegistry:r},function(n){r.registerComponent(e,n)})}var _="_gondel_",y="_gondelA_";function E(n){return function(n){return void 0!==n.nodeType}(n)?n:n[0]}function w(n,e){void 0===e&&(e="g");var t=E(n)[_+e];return!(!t||!t._ctx)}function C(n,e){void 0===e&&(e="g");var t=b(E(n),e);if(!t)throw new Error('Could not find a started gondel component in namespace "'+e+"\",\nplease check if your component is mounted via 'hasMountedGondelComponent'");return t}function b(n,e){var t=n[_+e];if(t&&t._ctx)return t}function x(n,e,t){void 0===n&&(n=document.documentElement),void 0===t&&(t="g");for(var o=[],r="_gondel_"+t,i=E(n).querySelectorAll("[data-"+t+"-name"+(e?'="'+e+'"':"")+"]"),c=0;c<i.length;c++){var a=i[c],u=a[r];u&&u._ctx===a&&o.push(u)}return o}var M,N={focus:"focusin",blur:"focusout"},P=function(n,e){var t=window.Element.prototype,o=t.matches||t.matchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.webkitMatchesSelector;return(P=function(n,e){return o.call(n,e)})(n,e)};function A(n,e,t,o){!function(c,a,u){for(var s=!1,f=[],n=function(n){var e=c[n],t=e.handlerOptions,o=b(e.ctx,u);if(o){Object.defineProperty(a,"currentTarget",{get:function(){return e.target},configurable:!0}),s=!0;for(var r=0;r<t.length&&!a.cancelBubble;r++){var i=o[t[r].handlerName].call(o,a);"function"==typeof i&&f.push(i)}}},e=0;e<c.length&&!a.cancelBubble;e++)n(e);f.forEach(function(n){n()}),s&&delete a.currentTarget}(function(r,i,n){var c=function(n){for(var e=[],t=n;t;t=t.parentElement)e.push(t);return e}(n),a=[];c.forEach(function(n,e){var t=n.getAttribute(r),o=t&&i[t];o&&a.push({index:e,handlers:o})});var u=[];return a.forEach(function(n){var t=n.index,o=n.handlers;Object.keys(o).forEach(function(n){if(!n)return u.push({index:t,ctx:c[t],target:c[t],handlerOptions:o[n]});for(var e=t;0<=--e;)if(P(c[e],n))return u.push({index:e,ctx:c[t],target:c[e],handlerOptions:o[n]})})}),0===u.length?[]:(u.sort(function(n,e){return n.index>e.index?1:n.index===e.index?0:-1}),u)}(e,t,o.target),o,n)}function O(n){return M||(M=window["__ðŸš¡DomEvents"]||{},window["__ðŸš¡DomEvents"]=M),M[n]||(M[n]={}),M[n]}function S(e,t,n,o,r){var i=O(e);i[t]||(i[t]={},s("registerEvent",!0,{eventName:t,namespace:e,eventRegistry:i[t]},function(n){n&&function(n,e){document.documentElement.addEventListener(N[n]||n,A.bind(null,e,"data-"+e+"-name",O(e)[n]))}(t,e)})),i[t][n]||(i[t][n]={});var c=("object"==typeof r?r:{selector:r}).selector||"";i[t][n][c]||(i[t][n][c]=[]),i[t][n][c].push(Object.assign({handlerName:o,handlerOption:r}))}function D(){t("GondelDecorators","register",function(n,e,t){var o=e.componentName,r=e.namespace;if(!e.gondelComponentRegistry._activeComponents[o])return t(n);var i=n.prototype&&n.prototype.__events||n.__events;i&&i.forEach(function(n){S(r,n[0],o,n[1],n[2])}),t(n)}),t("GondelDecorators","unregister",function(n,e,t){var o=e.componentName;!function(n,e){var t=O(n);for(var o in t)t.hasOwnProperty(o)&&delete t[o][e]}(e.namespace,o),t(n)}),t("GondelDecorators","start",function(n,e,t){var o=e.newComponentNames,r=e.gondelComponentRegistry,i=e.namespace;o.forEach(function(e){var n=r.getComponent(e),t=n.prototype&&n.prototype.__events||n.__events;t&&t.forEach(function(n){S(i,n[0],e,n[1],n[2])})}),t(n)})}var j=(B.prototype.stop=function(){},B);function B(n,e){}n.Component=function(e,t){return function(n){h(e,t,n)}},n.EventListener=function(t,o){return function(n,e){if(D(),"_"!==e.substr(0,1))throw new Error("Invalid handler name '"+e+"' use '_"+e+"' instead.");n.__events||(n.__events=[]),n.__events.push([t,e,o])}},n.GondelBaseComponent=j,n.addGondelPluginEventListener=t,n.disableAutoStart=function(n){void 0===n&&(n="g"),g(n).setBootMode(1)},n.findComponents=x,n.getComponentByDomNode=C,n.getComponentByDomNodeAsync=function(n,e){void 0===e&&(e="g");var t=E(n),o=t[y+e];return o?o._ctx?Promise.resolve(o):o.then(function(){return t[_+e]}):Promise.reject(void 0)},n.getFirstDomNode=E,n.hasMountedGondelComponent=w,n.registerComponent=h,n.startComponents=function(n,e){return void 0===e&&(e="g"),r(g(e),n?E(n):document.documentElement,e)},n.stopComponents=function(n,e){void 0===e&&(e="g");var t=x(n,void 0,e);n&&w(n)&&t.unshift(C(n)),t.forEach(function(n){return n.stop()})},n.triggerPublicEvent=f,Object.defineProperty(n,"__esModule",{value:!0})});
//# sourceMappingURL=gondel.es5.min.js.map
